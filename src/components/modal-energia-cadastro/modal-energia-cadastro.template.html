<ng-template #modalEnergiaCadastro let-c="close" let-d="dismiss">
  <div class="modal-body">
    <div class="card mb-4">
      <h4 class="card-header">
        <i class="fas fa-dollar-sign pr-2"></i>
        Cadastro de Despesas
      </h4>
      <div class="card-body">
        <form [formGroup]="formularioEnergiaDespesa" (ngSubmit)="onSubmit()" novalidate>

          <div class="form-group row">
            <div class="col-sm-7">
              <input type="hidden" class="form-control" formControlName="id">
            </div>
          </div>

          <div class="form-group row">
            <label class="col-form-label col-4 text-sm-right">Departamento*</label>
            <div class="col-8">
              <app-ngselect-departamentos (ngModelChange)="insertDepartamento()" formControlName="codigodepartamento" [initialValue]="(!!this.despesa.id && !!this.despesa.codigodepartamento ? this.despesa.codigodepartamento : null)" [itens]="itensDepartamentosSelect"></app-ngselect-departamentos>
              <input type="hidden" class="form-control {{projectFunctions.getClassValidField(formularioEnergiaDespesa, 'codigodepartamento')}}" formControlName="codigodepartamento">
              <small class="invalid-feedback">O campo deve ser preenchido. Verifique!</small>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-form-label col-4 text-sm-right">Tipo de Despesa*</label>
            <div class="col-8">
              <app-ngselect-despesas formControlName="tipodespesa" [selectedItem]="despesaSelect" [itens]="itensDespesasSelect"></app-ngselect-despesas>
              <input type="hidden"  class="form-control {{projectFunctions.getClassValidField(formularioEnergiaDespesa, 'tipodespesa')}}" formControlName="tipodespesa">
              <small class="invalid-feedback">O campo deve ser preenchido. Verifique!</small>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-form-label col-4 text-sm-right">Tipo de Ocorrência*</label>
            <div class="col-8">
              <select class="custom-select mr-sm-2 mb-2 mb-sm-0 form-control {{projectFunctions.getClassValidField(formularioEnergiaDespesa, 'tipoocorrencia')}}" placeholder="Tipo de ocorrência" formControlName="tipoocorrencia">  
                <option [value]="null" *ngIf="formularioEnergiaDespesa.value.tipoocorrencia === null" disabled>Selecione o tipo de ocorrência...</option>
                <option *ngFor="let tipo of listTipoOcorrencia" [value]="tipo.text" selected>{{tipo.text}}</option>                                
              </select> 
              <small class="invalid-feedback">
                O campo deve ser preenchido. Verifique!
              </small>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-form-label col-4 text-sm-right">CNPJ do Fornecedor*</label>
            <div class="col-8">
              <input type="text" [textMask]="this.projectMask.maskCNPJ"
                class="form-control {{projectFunctions.getClassValidField(formularioEnergiaDespesa, 'cnpjcpffornecedor')}}" formControlName="cnpjcpffornecedor"  
                placeholder="CNPJ do Fornecedor">
              <small class="invalid-feedback">
                O campo deve ser preenchido. Verifique!
              </small>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-form-label col-4 text-sm-right">Nome do Fornecedor*</label>
            <div class="col-8">
              <input type="text"
                class="form-control {{projectFunctions.getClassValidField(formularioEnergiaDespesa, 'nomefornecedor')}}" formControlName="nomefornecedor" placeholder="Nome do Fornecedor">
              <small class="invalid-feedback">
                O campo deve ser preenchido. Verifique!
              </small>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-form-label col-4 text-sm-right">Valor Total*</label>
            <div class="col-8">
              <input type="text"
                class="form-control {{projectFunctions.getClassValidField(formularioEnergiaDespesa, 'valortotal')}}" [textMask]="this.projectMask.currencyMaskOptions" formControlName="valortotal" placeholder="Valor total">
              <small class="invalid-feedback">
                O campo deve ser preenchido. Verifique!
              </small>
            </div>
          </div>

          <div class="form-group row ">
            <label class="col-form-label col-4 text-sm-right">Mês/Ano de Competência*</label>
            <div class="col-8">
              <ngb-datepicker  (navigate)="dateNavigate($event)" [startDate]="dataMesCompetencia" formControlName="mescompetencia" [showWeekdays]="false" class="datepicker-only-month-select"></ngb-datepicker>
              <input type="text" class="form-control" formControlName="mescompetencia" focused="false" class="form-control" hidden>        
            </div>
          </div>         

          <div class="form-group row">
            <label class="col-form-label col-4 text-sm-right">Data Emissão NF</label>
            <div class="col-8">
              <ngbdatepicker #dataemissaonf_component [(value)]="formularioEnergiaDespesa.value.dataemissaonf" [formName]="'dataemissaonf_component'" (valueChange)="changeValueDateComponent($event, 'dataemissaonf_component')"></ngbdatepicker>
              <input type="text" class="form-control" formControlName="dataemissaonf" focused="false" class="form-control" hidden>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-form-label col-4 text-sm-right">Data Vencimento NF</label>
            <div class="col-8">
              <ngbdatepicker #datavencimentonf_component [(value)]="formularioEnergiaDespesa.value.datavencimentonf" [formName]="'datavencimentonf_component'" (valueChange)="changeValueDateComponent($event, 'datavencimentonf_component')"></ngbdatepicker>
              <input type="text" class="form-control" formControlName="datavencimentonf" focused="false" class="form-control" hidden>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-form-label col-4 text-sm-right">Número Contrato</label>
            <div class="col-8">
              <input type="text" class="form-control" formControlName="numerocontrato" placeholder="Nº Contrato">
            </div>
          </div>          

          <div class="form-group row">
            <label class="col-form-label col-4 text-sm-right">Descrição Despesa</label>
            <div class="col-8">
              <textarea type="text" class="form-control" formControlName="descricaodespesa" placeholder="Descrição da despesa, com mais detalhes"></textarea>
            </div>
          </div>  

            <div class="form-group row">
              <label class="col-form-label col-4 text-sm-right">Transações*</label>
              <div class="col-8">
                <ng-select 
                 class="custom-material-style"  
                 formControlName="transacoes"
                 bindLabel="transacao"
                 bindValue="transacao"
                 [typeToSearchText]="'Digite algo para pesquisar...'"
                 [items]="listTrasacoes"
                 [loadingText]="'Buscando Registros...'"
                 [notFoundText]="'Nenhum item encotrado'"
                 [clearAllText]="'Limpar a Seleção'"
                 [placeholder]="'Digite a Transação'"
                > 
               <ng-template ng-option-tmp let-item="item" let-search="searchTerm">
                 <div ><span><strong>Transação: </strong></span></div>
                 <span style="font-size:smaller">{{ item.transacao }}</span>
               </ng-template>
               </ng-select>
                <input type="hidden" class="form-control {{projectFunctions.getClassValidField(formularioEnergiaDespesa, 'transacoes')}}" formControlName="transacoes">
                <small class="invalid-feedback">
                  O campo deve ser preenchido. Verifique!
                </small>
              </div>
            </div>

            <div class="form-group row">
              <label class="col-form-label col-4 text-sm-right">NF Eletrônica?*</label>
              <div class="col-8">
                <select class="custom-select mr-sm-2 mb-2 mb-sm-0 form-control {{projectFunctions.getClassValidField(formularioEnergiaDespesa, 'nfeletronicasimnao')}}" placeholder="Nota Fiscal Eletrônica?" formControlName="nfeletronicasimnao">  
                  <option [value]="null" *ngIf="formularioEnergiaDespesa.value.nfeletronicasimnao === null" disabled>Selecione o item...</option>
                  <option *ngFor="let tipo of listSimNao" [value]="tipo.text" selected>{{tipo.text}}</option>                                
                </select> 
                <small class="invalid-feedback">
                  O campo deve ser preenchido. Verifique!
                </small>
              </div>
            </div>

            <div class="form-group row">
              <label class="col-form-label col-4 text-sm-right">Número NF</label>
              <div class="col-8">
                <input type="text" class="form-control" formControlName="numeronotafiscal" placeholder="Nº Nota Fiscal">
              </div>
            </div>

            <div class="form-group row">
              <label class="col-form-label col-4 text-sm-right">Série NF Eletrônica</label>
              <div class="col-8">
                <input type="text" class="form-control" formControlName="serienf" placeholder="Série Nota Fiscal Eletrônica">
              </div>
            </div>  
            
            <div class="form-group row">
              <label class="col-form-label col-4 text-sm-right">ODI</label>
              <div class="col-8">
                <input type="text" class="form-control" formControlName="odi" placeholder="ODI">
              </div>
            </div>

            <div class="form-group row">
              <label class="col-form-label col-4 text-sm-right">Pedido de Compra</label>
              <div class="col-8">
                <input type="text" class="form-control" formControlName="pedidocompra" placeholder="Pedido de Compra">
              </div>
            </div> 
            
            <hr>        
              <p class="col-form-label text-center font-weight">Rateio de Contas</p>
            <hr>
            
            <div class="form-group row"> 
              <label class="col-form-label col-4 text-sm-right">Centro de Custo*</label>          
              <div class="col-8">          
                <ng-select 
                  class="custom-material-style" 
                  [multiple]="true"
                  [closeOnSelect]="true"
                  [hideSelected]="true"  
                  formControlName="cc"
                  bindLabel="descricao"
                  bindValue="centrocusto"                          
                  [typeToSearchText]="'Digite algo para pesquisar...'"
                  [items]="listCentroCusto"
                  [loadingText]="'Buscando Registros...'"
                  [notFoundText]="'Nenhum item encontrado'"
                  [clearAllText]="'Limpar Seleção'"
                  [placeholder]="'Digite o Centro de Custo'"
                  [(ngModel)]="centrosCustoSelecionados"
                  (change)="handleSelectionChange()"
                > 
                  <ng-template ng-option-tmp let-item="item" let-search="searchTerm">
                    <div ><span><strong>{{ item.descricao }}</strong></span></div>
                    <small>Código: {{item.centrocusto}}</small>
                  </ng-template>              
                </ng-select>
                <input type="hidden" class="form-control {{projectFunctions.getClassValidField(formularioEnergiaDespesa, 'cc')}}">
                <small class="invalid-feedback">
                  O campo deve ser preenchido. Verifique!
                </small>
              </div>
            </div>
        </form>
        
        <div *ngIf="centrosCustoSelecionados.length > 0 && valoresCC !== undefined" >
          <label class="col-form-label col-sm-3 text-sm-right">Valor Centro de Custo</label>
          <div *ngFor=" let codigoCentroCusto of centrosCustoSelecionados; let i = index"  class="form-group row">
            <div class="col-sm-3 text-sm-right">
              <div class="pt-2" style="font-size: 11px;">{{getCentroCusto(codigoCentroCusto)}} - R$</div>               
            </div>
            <div class="col-sm-6">
              <input  id="valorcc" type="text"  class="form-control" [textMask]="this.projectMask.currencyMaskOptions" [(ngModel)]="valoresCC[i]"  placeholder="Insira o valor do centro de custo">
            </div>
          </div>
        </div>

      </div>  
      
          <div class="text-right mt-3">
            <button type="button" class="btn btn-danger" (click)="close()"><i class="fas fa-times"></i>&nbsp;&nbsp; Cancelar</button> &nbsp;&nbsp;
            <button type="button" class="btn btn-primary" (click)="onSubmit()"><i class="fas fa-save"></i>&nbsp;&nbsp;Gravar</button>
          </div>       
      
    </div>
    <div class="modal-footer text-center">      
    </div>
  </div>
</ng-template>